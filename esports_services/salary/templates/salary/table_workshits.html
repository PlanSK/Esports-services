{% load bootstrap_icons %}
{% load salary_tags %}
{% load humanize %}
<div class="row verysmall text-center mb-2 border border-secondary">
  <div class="col">
    {% if previous_date %}
    <a href="{% url 'archive_view' year=previous_date.year month=previous_date.month %}" class="link-primary"> << {{ previous_date|date:"F Y г." }}</a>
    {% endif %}
  </div>
  <div class="col">{{ current_date|date:"F Y г." }}</div>
  <div class="col">
    {% if next_date %}
    <a href="{% url 'archive_view' year=next_date.year month=next_date.month %}" class="link-primary">{{ next_date|date:"F Y г." }} >></a>
    {% endif %}
  </div>
</div>
<div class="row">
    <div class="col-md-12 border">
      <table class="table table-dark table-hover">
        <thead class="text-warning text-center verysmall">
          <tr>
            {% table_header user as cols %}
            {% for col in cols %}
            <th scope="col">{{ col }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody class="text-center verysmall">

          {% for table in tables %}
          <tr>
            <td>{{ table.shift_date|date:"d.m.Y" }}</td>
            <td>{{ table.bar_revenue | intcomma }}</td>
            <td>{{ table.game_zone_revenue | intcomma }}</td>
            {% if table.game_zone_error %}
            <td class="text-danger">{{ table.game_zone_error | intcomma }}</td>
            {% else %}
            <td>-</td>
            {% endif %}
            <td>{{ table.vr_revenue | intcomma }}</td>
            <td>{{ table.get_summary_revenue | intcomma }}</td>
            
            {% if  user.profile.position.name == 'hall_admin' %}
            <td>
              {% icon_logic table.hall_admin_discipline %}
            </td>
            <td>
              {% icon_logic table.hall_cleaning %}
            </td>
            {% elif  user.profile.position.name == 'cash_admin' %}
            <td>
              {% icon_logic table.cash_admin_discipline %}
            </td>
            <td class="text-danger">{{table.shortage|default:"-"}}</td>
            {% endif %}
            <td>
              {% if table.is_verified %}
                {% kpi_salary workshift=table user=user as kpi_data %}
                {{ kpi_data.shift_salary|floatformat:"1g" |intcomma }}
              {% else %}
                <span title='Расчитывается после проверки'>{% bs_icon 'lock' color='gray' %}</span>
              {% endif %}
            </td>

            <td>
              {% if table.is_verified %}
                <span title="Проверено">{% bs_icon 'check2-circle' color='green' %}</span>
              {% elif user.profile.position.name == 'cash_admin' %}
                <a title="Внести изменения" href="{% url 'edit_workshift' table.slug %}">
                  {% bs_icon 'pencil-square' color='yellow' %}
                </a>
              {% else %}
                <span title='Ожидает проверки'>{% bs_icon 'stopwatch' color='yellow'%}</span>
              {% endif %}
            </td>
            {% if  user.profile.position.name == 'cash_admin' %}
              <td>
                <span title="{{ table.comment }}">{{ table.comment|truncatechars:12 }}</span>
              </td>
            {% endif %}
          </tr>
          {% endfor %}
        </tbody>
        <tfoot class="text-center verysmall text-white">
          <tr>
            <td scope="col">Итог за {{ current_date|date:"F" }}</td>
            <td scope="col">{{ total_values.bar|floatformat:"1g" | intcomma }}</td>
            <td scope="col">{{ total_values.game_zone|floatformat:"1g" | intcomma }}</td>
            <td scope="col">{{ total_values.game_zone_error|floatformat:"1g" | intcomma }}</td>
            <td scope="col">{{ total_values.vr|floatformat:"1g" | intcomma }}</td>
            <td scope="col">{{ total_values.sum_revenue|floatformat:"1g" | intcomma }}</td>
            {% if  user.profile.position.name == 'hall_admin' %}
            <td>{{ total_values.total_discipline }}%</td>
            <td>{{ total_values.total_cleaning }}%</td>
            {% elif  user.profile.position.name == 'cash_admin' %}
            <td>{{ total_values.total_discipline }}%</td>
            <td class="text-danger">{{ total_values.summary_shortage | intcomma }}</td>
            {% endif %}
            <td scope="col">{{ total_values.total_salary|floatformat:"1g" | intcomma }}</td>
            <td></td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>